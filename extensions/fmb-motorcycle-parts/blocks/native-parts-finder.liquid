{% comment %}
  FMB Native Motorcycle Parts Finder
  
  This block renders natively within the Shopify theme and handles:
  - Main finder page at /pages/fit-my-bike
  - Specific motorcycle pages at /pages/fit-my-bike?bikeid=1001
{% endcomment %}

{%- liquid
  assign block_id = block.id
  assign api_base_url = block.settings.api_base_url
  assign widget_title = block.settings.widget_title | default: 'Find Your Motorcycle Parts'
  assign show_header = block.settings.show_header | default: true
  assign auto_detect_page = block.settings.auto_detect_page | default: true
-%}

<div class="fmb-native-parts-finder" id="fmb-native-finder-{{ block_id }}" {{ block.shopify_attributes }}>
  {% if show_header %}
    <div class="fmb-native-header">
      {% if widget_title != blank %}
        <h1 class="fmb-native-title">{{ widget_title }}</h1>
      {% endif %}
      {% if block.settings.widget_description != blank %}
        <p class="fmb-native-description">{{ block.settings.widget_description }}</p>
      {% endif %}
    </div>
  {% endif %}

  <div class="fmb-native-content" id="fmb-native-content-{{ block_id }}">
    <div class="fmb-native-loading">
      <div class="fmb-loading-spinner"></div>
      <p>Loading motorcycle parts finder...</p>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const blockId = '{{ block_id }}';
    const containerId = 'fmb-native-content-' + blockId;
    const container = document.getElementById(containerId);
    
    if (!container) return;

    const config = {
      apiBaseUrl: '{{ api_base_url | default: "" }}' || window.location.origin,
      shopDomain: window.Shopify?.shop || '{{ shop.permanent_domain }}',
      autoDetectPage: {{ auto_detect_page }},
      blockId: blockId
    };

    // Check if we're on a fit-my-bike page and extract bikeid
    const currentPath = window.location.pathname;
    const urlParams = new URLSearchParams(window.location.search);
    const bikeid = urlParams.get('bikeid');
    
    let pageType = 'finder';
    if (currentPath.includes('/pages/fit-my-bike') || currentPath.includes('/fit-my-bike')) {
      pageType = bikeid ? 'motorcycle-parts' : 'finder';
    }

    // Initialize the appropriate widget
    if (pageType === 'motorcycle-parts' && bikeid) {
      initializeMotorcyclePage(config, bikeid, container);
    } else {
      initializeFinderPage(config, container);
    }

    function initializeFinderPage(config, container) {
      // Load the main motorcycle finder
      fetch(`${config.apiBaseUrl}/api/motorcycles/makes`)
        .then(response => response.json())
        .then(makes => {
          container.innerHTML = generateFinderHTML(makes, config);
          setupFinderInteractions(config, container);
        })
        .catch(error => {
          console.error('Error loading finder:', error);
          container.innerHTML = `
            <div class="fmb-native-error">
              <p>Unable to load motorcycle finder. Please try again later.</p>
            </div>
          `;
        });
    }

    function initializeMotorcyclePage(config, bikeid, container) {
      // Load specific motorcycle data and compatible parts
      Promise.all([
        fetch(`${config.apiBaseUrl}/api/motorcycles?recid=${bikeid}`).then(r => r.json()),
        fetch(`${config.apiBaseUrl}/api/customer/motorcycles/${bikeid}/compatible-parts`).then(r => r.json())
      ])
      .then(([motorcycles, parts]) => {
        const motorcycle = motorcycles[0];
        if (!motorcycle) {
          throw new Error('Motorcycle not found');
        }
        
        // Update SEO meta tags for this specific motorcycle
        updateSEOForMotorcycle(motorcycle, parts, bikeid);
        
        container.innerHTML = generateMotorcyclePageHTML(motorcycle, parts, config);
        setupPartInteractions(config, container);
      })
      .catch(error => {
        console.error('Error loading motorcycle page:', error);
        container.innerHTML = `
          <div class="fmb-native-error">
            <p>Unable to load motorcycle parts. Please try again later.</p>
          </div>
        `;
      });
    }

    function updateSEOForMotorcycle(motorcycle, parts, bikeid) {
      // Generate dynamic page title
      const pageTitle = `${motorcycle.bikemake} ${motorcycle.bikemodel} ${motorcycle.bikeyear} Parts - Motorcycle Parts | {{ shop.name }}`;
      document.title = pageTitle;
      
      // Update or create meta description
      const partCount = parts ? parts.length : 0;
      const metaDescription = `Shop ${partCount} compatible parts for ${motorcycle.bikemake} ${motorcycle.bikemodel} ${motorcycle.bikeyear}. Find sprockets, chains, and more motorcycle parts with fast shipping.`;
      updateMetaTag('description', metaDescription);
      
      // Open Graph meta tags for social sharing
      updateMetaTag('og:title', pageTitle, 'property');
      updateMetaTag('og:description', metaDescription, 'property');
      updateMetaTag('og:url', window.location.href, 'property');
      updateMetaTag('og:type', 'website', 'property');
      updateMetaTag('og:site_name', '{{ shop.name }}', 'property');
      
      // Twitter Card meta tags
      updateMetaTag('twitter:card', 'summary_large_image', 'name');
      updateMetaTag('twitter:title', pageTitle, 'name');
      updateMetaTag('twitter:description', metaDescription, 'name');
      
      // Add canonical URL
      updateLinkTag('canonical', window.location.href);
      
      // Add structured data (JSON-LD) for search engines
      addStructuredData(motorcycle, parts, bikeid);
    }
    
    function updateMetaTag(name, content, attribute = 'name') {
      let meta = document.querySelector(`meta[${attribute}="${name}"]`);
      if (!meta) {
        meta = document.createElement('meta');
        meta.setAttribute(attribute, name);
        document.head.appendChild(meta);
      }
      meta.setAttribute('content', content);
    }
    
    function updateLinkTag(rel, href) {
      let link = document.querySelector(`link[rel="${rel}"]`);
      if (!link) {
        link = document.createElement('link');
        link.setAttribute('rel', rel);
        document.head.appendChild(link);
      }
      link.setAttribute('href', href);
    }
    
    function addStructuredData(motorcycle, parts, bikeid) {
      // WebPage schema with Vehicle information
      const webPageSchema = {
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": `${motorcycle.bikemake} ${motorcycle.bikemodel} ${motorcycle.bikeyear} Parts`,
        "description": `Compatible motorcycle parts for ${motorcycle.bikemake} ${motorcycle.bikemodel} ${motorcycle.bikeyear}`,
        "url": window.location.href,
        "about": {
          "@type": "Vehicle",
          "name": `${motorcycle.bikemake} ${motorcycle.bikemodel}`,
          "manufacturer": {
            "@type": "Organization",
            "name": motorcycle.bikemake
          },
          "model": motorcycle.bikemodel,
          "vehicleModelDate": motorcycle.bikeyear,
          "vehicleEngine": {
            "@type": "EngineSpecification",
            "name": motorcycle.bikeengine || "Standard Engine"
          }
        }
      };
      
      // ItemList schema for products/parts
      const itemListSchema = {
        "@context": "https://schema.org",
        "@type": "ItemList",
        "name": `${motorcycle.bikemake} ${motorcycle.bikemodel} ${motorcycle.bikeyear} Compatible Parts`,
        "numberOfItems": parts.length,
        "itemListElement": parts.map((part, index) => ({
          "@type": "ListItem",
          "position": index + 1,
          "item": {
            "@type": "Product",
            "name": part.title,
            "sku": part.sku,
            "description": part.compatibility || `Compatible with ${motorcycle.bikemake} ${motorcycle.bikemodel}`,
            "offers": {
              "@type": "Offer",
              "price": part.price,
              "priceCurrency": "{{ shop.currency }}",
              "availability": (part.variants && part.variants.length > 0 && part.variants.some(v => v.available)) ? "https://schema.org/InStock" : "https://schema.org/OutOfStock"
            }
          }
        }))
      };
      
      // Remove existing structured data
      const existingScripts = document.querySelectorAll('script[type="application/ld+json"][data-fmb-seo]');
      existingScripts.forEach(script => script.remove());
      
      // Add WebPage structured data
      const webPageScript = document.createElement('script');
      webPageScript.type = 'application/ld+json';
      webPageScript.setAttribute('data-fmb-seo', 'webpage');
      webPageScript.textContent = JSON.stringify(webPageSchema);
      document.head.appendChild(webPageScript);
      
      // Add ItemList structured data (only if there are parts)
      if (parts && parts.length > 0) {
        const itemListScript = document.createElement('script');
        itemListScript.type = 'application/ld+json';
        itemListScript.setAttribute('data-fmb-seo', 'itemlist');
        itemListScript.textContent = JSON.stringify(itemListSchema);
        document.head.appendChild(itemListScript);
      }
    }

    function generateFinderHTML(makes, config) {
      return `
        <div class="fmb-finder-form">
          <!-- Quick Search Section -->
          <div class="fmb-quick-search">
            <h3>💨 Quick Search</h3>
            <p>Search directly for your motorcycle model</p>
            <div class="fmb-search-input-group">
              <input type="text" id="quick-search-${config.blockId}" class="fmb-search-input" 
                     placeholder="e.g., Honda CRF450R 2023" 
                     autocomplete="off">
              <div id="suggestions-dropdown-${config.blockId}" class="fmb-suggestions-dropdown"></div>
            </div>
          </div>
          
          <!-- Filter Search Section -->
          <h3>Search by Make, Model & Year</h3>
          <div class="fmb-form-grid">
            <div class="fmb-form-group">
              <label for="make-select-${config.blockId}">🏭 Make</label>
              <select id="make-select-${config.blockId}" class="fmb-select">
                <option value="">Choose your bike make</option>
                ${makes.map(make => `<option value="${make}">${make}</option>`).join('')}
              </select>
            </div>
            
            <div class="fmb-form-group">
              <label for="model-select-${config.blockId}">🏍️ Model</label>
              <select id="model-select-${config.blockId}" class="fmb-select" disabled>
                <option value="">Choose your bike model</option>
              </select>
            </div>
            
            <div class="fmb-form-group">
              <label for="year-select-${config.blockId}">📅 Year</label>
              <select id="year-select-${config.blockId}" class="fmb-select" disabled>
                <option value="">Choose your bike year</option>
              </select>
            </div>
          </div>
          
          <button id="find-parts-btn-${config.blockId}" class="fmb-find-button" disabled>
            🔍 Find Compatible Parts
          </button>
          
          <div id="results-${config.blockId}" class="fmb-results"></div>
        </div>
      `;
    }

    function generateMotorcyclePageHTML(motorcycle, parts, config) {
      return `
        <div class="fmb-motorcycle-page">
          <div class="fmb-motorcycle-header">
            <h2>${motorcycle.bikemake} ${motorcycle.bikemodel} (${motorcycle.bikeyear})</h2>
            <p class="fmb-motorcycle-engine">Engine: ${motorcycle.bikeengine || 'All Engines'}</p>
            <a href="/pages/fit-my-bike" class="fmb-back-link">← Search for Different Motorcycle</a>
          </div>
          
          <div class="fmb-parts-grid">
            ${parts.map(part => `
              <div class="fmb-part-card">
                <div class="fmb-part-image">
                  ${part.images && part.images[0] ? 
                    `<img src="${part.images[0]}" alt="${part.title}" loading="lazy">` : 
                    '<div class="fmb-part-placeholder">No Image</div>'
                  }
                </div>
                <div class="fmb-part-info">
                  <h3 class="fmb-part-title">${part.title}</h3>
                  <p class="fmb-part-price">$${part.price}</p>
                  <button class="fmb-add-to-cart" data-variant-id="${part.variant_id}">
                    Add to Cart
                  </button>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    function setupFinderInteractions(config, container) {
      const quickSearch = container.querySelector(`#quick-search-${config.blockId}`);
      const suggestionsDropdown = container.querySelector(`#suggestions-dropdown-${config.blockId}`);
      const makeSelect = container.querySelector(`#make-select-${config.blockId}`);
      const modelSelect = container.querySelector(`#model-select-${config.blockId}`);
      const yearSelect = container.querySelector(`#year-select-${config.blockId}`);
      const findButton = container.querySelector(`#find-parts-btn-${config.blockId}`);
      const results = container.querySelector(`#results-${config.blockId}`);

      let motorcycleData = [];

      // Load all motorcycle data for quick search
      fetch(`${config.apiBaseUrl}/api/motorcycles`)
        .then(response => response.json())
        .then(motorcycles => {
          motorcycleData = motorcycles;
        })
        .catch(error => console.error('Error loading motorcycles:', error));

      // Quick search functionality
      let searchTimeout;
      quickSearch.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        const query = this.value.trim();
        
        if (query.length < 2) {
          suggestionsDropdown.style.display = 'none';
          return;
        }
        
        searchTimeout = setTimeout(() => {
          const matches = motorcycleData.filter(bike => {
            const searchText = `${bike.bikemake} ${bike.bikemodel} ${bike.bikeyear}`.toLowerCase();
            return searchText.includes(query.toLowerCase());
          }).slice(0, 10);
          
          if (matches.length > 0) {
            suggestionsDropdown.innerHTML = matches.map(bike => 
              `<div class="fmb-suggestion-item" data-bikeid="${bike.recid}">
                ${bike.bikemake} ${bike.bikemodel} (${bike.bikeyear})
              </div>`
            ).join('');
            suggestionsDropdown.style.display = 'block';
          } else {
            suggestionsDropdown.style.display = 'none';
          }
        }, 300);
      });

      // Handle suggestion clicks
      suggestionsDropdown.addEventListener('click', function(e) {
        if (e.target.classList.contains('fmb-suggestion-item')) {
          const bikeid = e.target.dataset.bikeid;
          window.location.href = `/pages/fit-my-bike?bikeid=${bikeid}`;
        }
      });

      // Hide suggestions when clicking outside
      document.addEventListener('click', function(e) {
        if (!quickSearch.contains(e.target) && !suggestionsDropdown.contains(e.target)) {
          suggestionsDropdown.style.display = 'none';
        }
      });

      // Handle cascading dropdowns: Make → Model → Year
      makeSelect.addEventListener('change', function() {
        const selectedMake = this.value;
        
        // Reset model and year
        modelSelect.innerHTML = '<option value="">Choose your bike model</option>';
        modelSelect.disabled = !selectedMake;
        yearSelect.innerHTML = '<option value="">Choose your bike year</option>';
        yearSelect.disabled = true;
        
        if (selectedMake) {
          const models = [...new Set(motorcycleData
            .filter(m => m.bikemake === selectedMake)
            .map(m => m.bikemodel)
          )].sort();
          
          models.forEach(model => {
            const option = document.createElement('option');
            option.value = model;
            option.textContent = model;
            modelSelect.appendChild(option);
          });
        }
        updateFindButton();
      });

      modelSelect.addEventListener('change', function() {
        const selectedMake = makeSelect.value;
        const selectedModel = this.value;
        
        // Reset year
        yearSelect.innerHTML = '<option value="">Choose your bike year</option>';
        yearSelect.disabled = !selectedModel;
        
        if (selectedMake && selectedModel) {
          const years = new Set();
          motorcycleData
            .filter(m => m.bikemake === selectedMake && m.bikemodel === selectedModel)
            .forEach(m => {
              for (let year = m.firstyear; year <= m.lastyear; year++) {
                years.add(year);
              }
            });
          
          [...years].sort((a, b) => b - a).forEach(year => {
            const option = document.createElement('option');
            option.value = year;
            option.textContent = year;
            yearSelect.appendChild(option);
          });
        }
        updateFindButton();
      });

      yearSelect.addEventListener('change', updateFindButton);

      function updateFindButton() {
        const hasSelections = makeSelect.value && modelSelect.value && yearSelect.value;
        findButton.disabled = !hasSelections;
      }

      findButton.addEventListener('click', function() {
        const make = makeSelect.value;
        const model = modelSelect.value;
        const year = parseInt(yearSelect.value);
        
        if (!make || !model || !year) return;
        
        // Find the specific motorcycle
        const motorcycle = motorcycleData.find(m => 
          m.bikemake === make && 
          m.bikemodel === model && 
          year >= m.firstyear && 
          year <= m.lastyear
        );
        
        if (motorcycle) {
          window.location.href = `/pages/fit-my-bike?bikeid=${motorcycle.recid}`;
        } else {
          results.innerHTML = '<p class="fmb-no-results">No matching motorcycle found.</p>';
        }
      });
    }

    function setupPartInteractions(config, container) {
      // Handle add to cart buttons
      container.addEventListener('click', function(e) {
        if (e.target.classList.contains('fmb-add-to-cart')) {
          const variantId = e.target.dataset.variantId;
          if (variantId && window.Shopify) {
            // Add to Shopify cart
            fetch('/cart/add.js', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                id: variantId,
                quantity: 1
              })
            })
            .then(response => response.json())
            .then(() => {
              e.target.textContent = 'Added!';
              e.target.disabled = true;
              setTimeout(() => {
                e.target.textContent = 'Add to Cart';
                e.target.disabled = false;
              }, 2000);
              
              // Trigger cart refresh
              if (window.Shopify && window.Shopify.onItemAdded) {
                window.Shopify.onItemAdded();
              }
            })
            .catch(error => {
              console.error('Error adding to cart:', error);
              e.target.textContent = 'Error';
              setTimeout(() => {
                e.target.textContent = 'Add to Cart';
              }, 2000);
            });
          }
        }
      });
    }
  });
</script>

<style>
  .fmb-native-parts-finder {
    font-family: var(--font-body-family, -apple-system, BlinkMacSystemFont, sans-serif);
    margin: 2rem 0;
  }

  .fmb-native-header {
    text-align: center;
    margin-bottom: 2rem;
  }

  .fmb-native-title {
    font-size: 2rem;
    font-weight: bold;
    margin-bottom: 0.5rem;
    color: rgb(var(--color-foreground, 0 0 0));
  }

  .fmb-native-description {
    font-size: 1.1rem;
    color: rgba(var(--color-foreground, 0 0 0), 0.7);
    max-width: 600px;
    margin: 0 auto;
  }

  .fmb-finder-form {
    max-width: 800px;
    margin: 0 auto;
  }

  .fmb-quick-search {
    margin-bottom: 30px;
    padding-bottom: 30px;
    border-bottom: 2px solid rgba(var(--color-foreground, 0 0 0), 0.1);
  }
  
  .fmb-quick-search h3 {
    margin: 0 0 10px 0;
    color: rgb(var(--color-foreground, 0 0 0));
    font-size: 1.3rem;
  }
  
  .fmb-quick-search p {
    color: rgba(var(--color-foreground, 0 0 0), 0.7);
    margin-bottom: 15px;
    font-size: 0.95rem;
  }
  
  .fmb-search-input-group {
    position: relative;
    display: flex;
    gap: 15px;
  }
  
  .fmb-search-input {
    flex: 1;
    padding: 15px;
    border: 2px solid rgba(var(--color-foreground, 0 0 0), 0.2);
    border-radius: 8px;
    font-size: 16px;
    transition: border-color 0.2s;
  }
  
  .fmb-search-input:focus {
    border-color: rgb(var(--color-button, 0 123 255));
    outline: none;
    box-shadow: 0 0 0 3px rgba(var(--color-button, 0 123 255), 0.1);
  }
  
  .fmb-suggestions-dropdown {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: rgb(var(--color-background, 255 255 255));
    border: 1px solid rgba(var(--color-foreground, 0 0 0), 0.2);
    border-radius: 8px;
    max-height: 300px;
    overflow-y: auto;
    z-index: 1000;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    margin-top: 4px;
  }
  
  .fmb-suggestion-item {
    padding: 12px 16px;
    cursor: pointer;
    border-bottom: 1px solid rgba(var(--color-foreground, 0 0 0), 0.1);
    transition: background-color 0.2s;
  }
  
  .fmb-suggestion-item:hover {
    background: rgba(var(--color-button, 0 123 255), 0.1);
  }
  
  .fmb-suggestion-item:last-child {
    border-bottom: none;
  }

  .fmb-form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .fmb-form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: rgb(var(--color-foreground, 0 0 0));
  }

  .fmb-select {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid rgba(var(--color-foreground, 0 0 0), 0.2);
    border-radius: 4px;
    background: rgb(var(--color-background, 255 255 255));
    color: rgb(var(--color-foreground, 0 0 0));
    font-size: 1rem;
  }

  .fmb-select:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .fmb-find-button {
    display: block;
    width: 100%;
    max-width: 300px;
    margin: 0 auto;
    padding: 1rem 2rem;
    background: rgb(var(--color-button, 0 123 255));
    color: rgb(var(--color-button-text, 255 255 255));
    border: none;
    border-radius: 4px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: opacity 0.2s;
  }

  .fmb-find-button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .fmb-find-button:not(:disabled):hover {
    opacity: 0.9;
  }

  .fmb-motorcycle-page {
    max-width: 1200px;
    margin: 0 auto;
  }

  .fmb-motorcycle-header {
    text-align: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid rgba(var(--color-foreground, 0 0 0), 0.1);
  }

  .fmb-motorcycle-header h2 {
    font-size: 1.8rem;
    margin-bottom: 0.5rem;
    color: rgb(var(--color-foreground, 0 0 0));
  }

  .fmb-motorcycle-engine {
    color: rgba(var(--color-foreground, 0 0 0), 0.7);
    margin-bottom: 1rem;
  }

  .fmb-back-link {
    color: rgb(var(--color-button, 0 123 255));
    text-decoration: none;
    font-weight: 500;
  }

  .fmb-back-link:hover {
    text-decoration: underline;
  }

  .fmb-parts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1.5rem;
  }

  .fmb-part-card {
    border: 1px solid rgba(var(--color-foreground, 0 0 0), 0.1);
    border-radius: 8px;
    overflow: hidden;
    background: rgb(var(--color-background, 255 255 255));
    transition: box-shadow 0.2s;
  }

  .fmb-part-card:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .fmb-part-image {
    aspect-ratio: 1;
    overflow: hidden;
    background: rgba(var(--color-foreground, 0 0 0), 0.05);
  }

  .fmb-part-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .fmb-part-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgba(var(--color-foreground, 0 0 0), 0.5);
    font-size: 0.9rem;
  }

  .fmb-part-info {
    padding: 1rem;
  }

  .fmb-part-title {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: rgb(var(--color-foreground, 0 0 0));
    line-height: 1.3;
  }

  .fmb-part-price {
    font-size: 1.1rem;
    font-weight: bold;
    color: rgb(var(--color-button, 0 123 255));
    margin-bottom: 1rem;
  }

  .fmb-add-to-cart {
    width: 100%;
    padding: 0.75rem;
    background: rgb(var(--color-button, 0 123 255));
    color: rgb(var(--color-button-text, 255 255 255));
    border: none;
    border-radius: 4px;
    font-weight: 600;
    cursor: pointer;
    transition: opacity 0.2s;
  }

  .fmb-add-to-cart:hover {
    opacity: 0.9;
  }

  .fmb-add-to-cart:disabled {
    opacity: 0.7;
    cursor: not-allowed;
  }

  .fmb-native-loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 200px;
    color: rgba(var(--color-foreground, 0 0 0), 0.6);
  }

  .fmb-loading-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid rgba(var(--color-foreground, 0 0 0), 0.1);
    border-top: 3px solid rgb(var(--color-button, 0 123 255));
    border-radius: 50%;
    animation: fmb-spinner-spin 1s linear infinite;
    margin-bottom: 1rem;
  }

  @keyframes fmb-spinner-spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  .fmb-native-error, .fmb-no-results, .fmb-error {
    text-align: center;
    padding: 2rem;
    color: rgba(var(--color-foreground, 0 0 0), 0.7);
  }

  @media screen and (max-width: 768px) {
    .fmb-form-grid {
      grid-template-columns: 1fr;
    }
    
    .fmb-parts-grid {
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    }
    
    .fmb-native-title {
      font-size: 1.5rem;
    }
  }
</style>

{{ 'fmb-motorcycle-parts-finder.css' | asset_url | stylesheet_tag }}

{% schema %}
{
  "name": "FMB Native Parts Finder",
  "target": "section",
  "settings": [
    {
      "type": "header",
      "content": "Content Settings"
    },
    {
      "type": "text",
      "id": "widget_title",
      "label": "Widget Title",
      "default": "Find Your Motorcycle Parts"
    },
    {
      "type": "textarea",
      "id": "widget_description",
      "label": "Widget Description",
      "default": "Search by year, make, and model to find compatible parts for your motorcycle"
    },
    {
      "type": "checkbox",
      "id": "show_header",
      "label": "Show Header",
      "default": true
    },
    {
      "type": "header",
      "content": "Configuration"
    },
    {
      "type": "url",
      "id": "api_base_url",
      "label": "API Base URL",
      "info": "Leave default to use current domain, or specify your FMB service URL"
    },
    {
      "type": "checkbox",
      "id": "auto_detect_page",
      "label": "Auto-detect Page Type",
      "info": "Automatically detect if this is a fit-my-bike page and show appropriate content",
      "default": true
    }
  ]
}
{% endschema %}